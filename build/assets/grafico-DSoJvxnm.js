document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("formulario-grafica");i.addEventListener("submit",function(l){l.preventDefault();const n=i.querySelector('[name="fecha_inicio"]').value,s=i.querySelector('[name="fecha_final"]').value,c=i.querySelector('[name="tipo"]').value;if(!n||!s){Swal.fire({toast:!0,position:"top-end",icon:"warning",title:"Error",text:"Por favor, selecciona ambas fechas",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}else document.getElementById("grafica-placeholder").style.display="none";$.ajax({method:"GET",url:`/grafico/mostrar/${c},${n},${s}`,dataType:"json",success:function(t){let a=[],o=[],r="";if(!t.data||t.data.length===0){window.miGrafica.destroy(),document.getElementById("grafica-placeholder").style.display="block",Swal.fire({toast:!0,position:"top-end",icon:"info",title:"Sin resultados",text:"No se encontraron datos para el rango de fechas seleccionado.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}switch(c){case"ventas":t.data.forEach(e=>{a.push(e.fecha),o.push(e.total_vendidos)}),r="Ventas Totales";break;case"productos":t.data.forEach(e=>{a.push(e.nombre_producto),o.push(e.cantidad_total)}),r="Cantidad por Producto";break;case"usuarios":t.data.forEach(e=>{a.push(e.nombre_usuario),o.push(e.Total)}),r="Total por Usuario";break;case"clientes":t.data.forEach(e=>{a.push(e.nombre_cliente),o.push(e.Total)}),r="Total por Cliente";break}const d=document.getElementById("miGrafica").getContext("2d");window.miGrafica&&typeof window.miGrafica.destroy=="function"&&window.miGrafica.destroy(),window.miGrafica=new Chart(d,{type:"bar",data:{labels:a,datasets:[{label:r,data:o,backgroundColor:"rgba(235, 166, 54, 0.6)",borderColor:"rgb(235, 99, 54)",borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})},error:function(t,a,o){Swal.fire({toast:!0,position:"top-end",icon:"error",title:"Error",text:"Error en la petici√≥n AJAX:",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})})});
